{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/DiveIntelligence/DiveIntelligence/src/app/utility/utility.ts"],"sourcesContent":["export function ceilingWithThreshold(ceiling: number, threshold: number = 0.000001): number {\n  return Math.ceil(ceiling - threshold);\n}\n\nexport function floorWithThreshold(floor: number, threshold: number = 0.000001): number {\n  return Math.floor(floor + threshold);\n}\n"],"names":[],"mappings":";;;;;;AAAO,SAAS,qBAAqB,OAAe,EAAE,YAAoB,QAAQ;IAChF,OAAO,KAAK,IAAI,CAAC,UAAU;AAC7B;AAEO,SAAS,mBAAmB,KAAa,EAAE,YAAoB,QAAQ;IAC5E,OAAO,KAAK,KAAK,CAAC,QAAQ;AAC5B"}},
    {"offset": {"line": 23, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/DiveIntelligence/DiveIntelligence/src/app/dive-planner-service/BreathingGas.ts"],"sourcesContent":["import { ceilingWithThreshold, floorWithThreshold } from '../utility/utility';\nimport { DiveSettingsService } from './DiveSettings.service';\n\nexport class BreathingGas {\n  description!: string;\n  compositionDescription!: string;\n  maxDepthPO2!: number;\n  maxDepthPO2Deco!: number;\n  maxDepthEND!: number;\n  minDepth!: number;\n  maxDecoDepth!: number;\n\n  private constructor(\n    public name: string,\n    public oxygen: number,\n    public helium: number,\n    public nitrogen: number,\n    private diveSettings: DiveSettingsService\n  ) {\n    this.diveSettings.subscribeToChanges(() => this.onDiveSettingsChanged());\n\n    this.updateDetails();\n  }\n\n  onDiveSettingsChanged(): void {\n    this.updateDetails();\n  }\n\n  static create(oxygen: number, helium: number, nitrogen: number, settings: DiveSettingsService): BreathingGas {\n    const gas = new BreathingGas('Custom', oxygen, helium, nitrogen, settings);\n\n    const standardGas = BreathingGas.StandardGases.find(g => g.isEquivalent(gas));\n    if (standardGas !== undefined) {\n      return new BreathingGas(standardGas.name, standardGas.oxygen, standardGas.helium, standardGas.nitrogen, settings);\n    }\n\n    return gas;\n  }\n\n  updateDetails(): void {\n    this.description = this.calcDescription();\n    this.compositionDescription = this.calcCompositionDescription();\n    this.maxDepthPO2 = this.calcMaxDepthPO2();\n    this.maxDepthPO2Deco = this.calcMaxDepthPO2Deco();\n    this.maxDepthEND = this.calcMaxDepthEND();\n    this.minDepth = this.calcMinDepth();\n    this.maxDecoDepth = this.calcMaxDecoDepth();\n  }\n\n  static StandardGases: BreathingGas[];\n\n  static GenerateStandardGases(settings: DiveSettingsService) {\n    this.StandardGases = [\n      new BreathingGas('Air', 21, 0, 79, settings),\n      new BreathingGas('Nitrox 32', 32, 0, 68, settings),\n      new BreathingGas('Oxygen', 100, 0, 0, settings),\n      new BreathingGas('Helitrox 25/25', 25, 25, 50, settings),\n      new BreathingGas('Helitrox 21/35', 21, 35, 44, settings),\n      new BreathingGas('Trimix 18/45', 18, 45, 37, settings),\n      new BreathingGas('Trimix 15/55', 15, 55, 30, settings),\n      new BreathingGas('Trimix 12/60', 12, 60, 28, settings),\n      new BreathingGas('Trimix 10/70', 10, 70, 20, settings),\n      new BreathingGas('Nitrox 50', 50, 0, 50, settings),\n      new BreathingGas('Helitrox 35/25', 35, 25, 40, settings),\n    ];\n  }\n\n  static getOptimalDecoGas(depth: number, settings: DiveSettingsService): BreathingGas {\n    const atm = depth / 10 + 1;\n    const oxygen = Math.min(100, floorWithThreshold((settings.decoPO2Maximum * 100) / atm));\n\n    let targetPN2 = (settings.ENDErrorThreshold / 10 + 1) * 79;\n\n    if (settings.isOxygenNarcotic) {\n      const targetNarcotic = (settings.ENDErrorThreshold / 10 + 1) * 100;\n      targetPN2 = targetNarcotic - oxygen * atm;\n    }\n\n    let nitrogen = targetPN2 / atm;\n    const helium = Math.max(0, ceilingWithThreshold(100 - oxygen - nitrogen));\n    nitrogen = 100 - oxygen - helium;\n\n    return BreathingGas.create(oxygen, helium, nitrogen, settings);\n  }\n\n  private calcDescription(): string {\n    return `${this.name} (${this.calcCompositionDescription()})`;\n  }\n\n  private calcCompositionDescription(): string {\n    return `O<sub>2</sub>: ${this.oxygen}%, He: ${this.helium}%, N<sub>2</sub>: ${this.nitrogen}%`;\n  }\n\n  private calcMaxDepthPO2(): number {\n    return Math.floor((this.diveSettings.workingPO2Maximum * 1000) / this.oxygen - 10);\n  }\n\n  private calcMaxDepthPO2Deco(): number {\n    return Math.floor((this.diveSettings.decoPO2Maximum * 1000) / this.oxygen - 10);\n  }\n\n  private calcMaxDepthEND(): number {\n    if (this.diveSettings.isOxygenNarcotic) {\n      return Math.floor(((this.diveSettings.ENDErrorThreshold + 10) * 100) / (this.nitrogen + this.oxygen) - 10);\n    } else {\n      return Math.floor((790 * ((this.diveSettings.ENDErrorThreshold + 10) / 10)) / this.nitrogen - 10);\n    }\n  }\n\n  private calcMinDepth(): number {\n    return Math.max(0, ceilingWithThreshold((this.diveSettings.pO2Minimum * 1000) / this.oxygen - 10));\n  }\n\n  private calcMaxDecoDepth(): number {\n    return Math.min(this.calcMaxDepthPO2Deco(), this.calcMaxDepthEND());\n  }\n\n  getPO2(depth: number): number {\n    return (depth / 10 + 1) * (this.oxygen / 100);\n  }\n\n  getPHe(depth: number): number {\n    return (depth / 10 + 1) * (this.helium / 100);\n  }\n\n  getPN2(depth: number): number {\n    return (depth / 10 + 1) * (this.nitrogen / 100);\n  }\n\n  getEND(depth: number): number {\n    if (this.diveSettings.isOxygenNarcotic) {\n      return Math.max(0, (this.getPN2(depth) + this.getPO2(depth) - 1) * 10);\n    }\n\n    return Math.max(0, (this.getPN2(depth) / 0.79 - 1) * 10);\n  }\n\n  isEquivalent(other: BreathingGas): boolean {\n    return this.oxygen === other.oxygen && this.helium === other.helium && this.nitrogen === other.nitrogen;\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 151, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/DiveIntelligence/DiveIntelligence/src/app/utility/formatters.ts"],"sourcesContent":["export function humanDuration(value: number): string {\n  const minutes = Math.floor(value / 60);\n  const seconds = Math.round(value % 60);\n\n  let result = `${minutes > 0 ? minutes + ' min' : ''}${seconds > 0 ? ' ' + seconds + ' sec' : ''}`;\n\n  result = result.trim();\n\n  if (minutes + seconds === 0) {\n    result = '0 sec ';\n  }\n\n  return result;\n}\n\nexport function colonDuration(value: number): string {\n  const hours = Math.floor(value / 3600);\n  const minutes = Math.floor((value - hours * 3600) / 60);\n  const seconds = Math.floor(value % 60);\n\n  let result = '';\n\n  if (hours > 0) {\n    result += hours + ':';\n    result += minutes < 10 ? '0' + minutes : minutes;\n    result += ':';\n  } else {\n    result += minutes + ':';\n  }\n\n  result += seconds < 10 ? '0' + seconds : seconds;\n\n  return result;\n}\n"],"names":[],"mappings":";;;;;;AAAO,SAAS,cAAc,KAAa;IACzC,MAAM,UAAU,KAAK,KAAK,CAAC,QAAQ;IACnC,MAAM,UAAU,KAAK,KAAK,CAAC,QAAQ;IAEnC,IAAI,SAAS,GAAG,UAAU,IAAI,UAAU,SAAS,KAAK,UAAU,IAAI,MAAM,UAAU,SAAS,IAAI;IAEjG,SAAS,OAAO,IAAI;IAEpB,IAAI,UAAU,YAAY,GAAG;QAC3B,SAAS;IACX;IAEA,OAAO;AACT;AAEO,SAAS,cAAc,KAAa;IACzC,MAAM,QAAQ,KAAK,KAAK,CAAC,QAAQ;IACjC,MAAM,UAAU,KAAK,KAAK,CAAC,CAAC,QAAQ,QAAQ,IAAI,IAAI;IACpD,MAAM,UAAU,KAAK,KAAK,CAAC,QAAQ;IAEnC,IAAI,SAAS;IAEb,IAAI,QAAQ,GAAG;QACb,UAAU,QAAQ;QAClB,UAAU,UAAU,KAAK,MAAM,UAAU;QACzC,UAAU;IACZ,OAAO;QACL,UAAU,UAAU;IACtB;IAEA,UAAU,UAAU,KAAK,MAAM,UAAU;IAEzC,OAAO;AACT"}},
    {"offset": {"line": 189, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/DiveIntelligence/DiveIntelligence/src/app/dive-planner-service/DiveSegment.ts"],"sourcesContent":["import { BreathingGas } from './BreathingGas';\nimport { DiveSettingsService } from './DiveSettings.service';\n\nexport class DiveSegment {\n  constructor(\n    public StartTimestamp: number,\n    public EndTimestamp: number,\n    public Title: string,\n    public Description: string,\n    public StartDepth: number,\n    public EndDepth: number,\n    public Gas: BreathingGas,\n    public Icon: string,\n    private settings: DiveSettingsService\n  ) {}\n\n  clone(): DiveSegment {\n    return new DiveSegment(\n      this.StartTimestamp,\n      this.EndTimestamp,\n      this.Title,\n      this.Description,\n      this.StartDepth,\n      this.EndDepth,\n      this.Gas,\n      this.Icon,\n      this.settings\n    );\n  }\n\n  getDuration(): number {\n    return this.EndTimestamp - this.StartTimestamp;\n  }\n\n  getAverageDepth(): number {\n    if (this.StartDepth === this.EndDepth) {\n      return this.StartDepth;\n    }\n\n    const travelAverageDepth = (this.StartDepth + this.EndDepth) / 2;\n    const travelTime = this.getTravelDuration();\n    const bottomTime = this.getDuration() - travelTime;\n\n    return (travelAverageDepth * travelTime + this.EndDepth * bottomTime) / this.getDuration();\n  }\n\n  getDepth(time: number): number {\n    if (time <= this.StartTimestamp) {\n      return this.StartDepth;\n    }\n\n    if (time >= this.EndTimestamp) {\n      return this.EndDepth;\n    }\n\n    const travelEnd = this.StartTimestamp + this.getTravelDuration();\n\n    if (time >= travelEnd) {\n      return this.EndDepth;\n    }\n\n    return this.StartDepth + ((this.EndDepth - this.StartDepth) * (time - this.StartTimestamp)) / (travelEnd - this.StartTimestamp);\n  }\n\n  private getTravelDuration(): number {\n    if (this.StartDepth === this.EndDepth) {\n      return 0;\n    }\n\n    if (this.StartDepth < this.EndDepth) {\n      const descentRatePerMeter = 60 / this.settings.descentRate;\n      return Math.round((this.EndDepth - this.StartDepth) * descentRatePerMeter);\n    }\n\n    if (this.EndDepth < this.StartDepth) {\n      const ascentRatePerMeter = 60 / this.settings.ascentRate;\n      return Math.round((this.StartDepth - this.EndDepth) * ascentRatePerMeter);\n    }\n\n    return 0; // should never happen\n  }\n}\n"],"names":[],"mappings":";;;;AAGO,MAAM;;;;;;;;;;IACX,YACE,AAAO,cAAsB,EAC7B,AAAO,YAAoB,EAC3B,AAAO,KAAa,EACpB,AAAO,WAAmB,EAC1B,AAAO,UAAkB,EACzB,AAAO,QAAgB,EACvB,AAAO,GAAiB,EACxB,AAAO,IAAY,EACnB,AAAQ,QAA6B,CACrC;aATO,iBAAA;aACA,eAAA;aACA,QAAA;aACA,cAAA;aACA,aAAA;aACA,WAAA;aACA,MAAA;aACA,OAAA;aACC,WAAA;IACP;IAEH,QAAqB;QACnB,OAAO,IAAI,YACT,IAAI,CAAC,cAAc,EACnB,IAAI,CAAC,YAAY,EACjB,IAAI,CAAC,KAAK,EACV,IAAI,CAAC,WAAW,EAChB,IAAI,CAAC,UAAU,EACf,IAAI,CAAC,QAAQ,EACb,IAAI,CAAC,GAAG,EACR,IAAI,CAAC,IAAI,EACT,IAAI,CAAC,QAAQ;IAEjB;IAEA,cAAsB;QACpB,OAAO,IAAI,CAAC,YAAY,GAAG,IAAI,CAAC,cAAc;IAChD;IAEA,kBAA0B;QACxB,IAAI,IAAI,CAAC,UAAU,KAAK,IAAI,CAAC,QAAQ,EAAE;YACrC,OAAO,IAAI,CAAC,UAAU;QACxB;QAEA,MAAM,qBAAqB,CAAC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,QAAQ,IAAI;QAC/D,MAAM,aAAa,IAAI,CAAC,iBAAiB;QACzC,MAAM,aAAa,IAAI,CAAC,WAAW,KAAK;QAExC,OAAO,CAAC,qBAAqB,aAAa,IAAI,CAAC,QAAQ,GAAG,UAAU,IAAI,IAAI,CAAC,WAAW;IAC1F;IAEA,SAAS,IAAY,EAAU;QAC7B,IAAI,QAAQ,IAAI,CAAC,cAAc,EAAE;YAC/B,OAAO,IAAI,CAAC,UAAU;QACxB;QAEA,IAAI,QAAQ,IAAI,CAAC,YAAY,EAAE;YAC7B,OAAO,IAAI,CAAC,QAAQ;QACtB;QAEA,MAAM,YAAY,IAAI,CAAC,cAAc,GAAG,IAAI,CAAC,iBAAiB;QAE9D,IAAI,QAAQ,WAAW;YACrB,OAAO,IAAI,CAAC,QAAQ;QACtB;QAEA,OAAO,IAAI,CAAC,UAAU,GAAG,AAAC,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,UAAU,IAAI,CAAC,OAAO,IAAI,CAAC,cAAc,IAAK,CAAC,YAAY,IAAI,CAAC,cAAc;IAChI;IAEQ,oBAA4B;QAClC,IAAI,IAAI,CAAC,UAAU,KAAK,IAAI,CAAC,QAAQ,EAAE;YACrC,OAAO;QACT;QAEA,IAAI,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,QAAQ,EAAE;YACnC,MAAM,sBAAsB,KAAK,IAAI,CAAC,QAAQ,CAAC,WAAW;YAC1D,OAAO,KAAK,KAAK,CAAC,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,UAAU,IAAI;QACxD;QAEA,IAAI,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAC,UAAU,EAAE;YACnC,MAAM,qBAAqB,KAAK,IAAI,CAAC,QAAQ,CAAC,UAAU;YACxD,OAAO,KAAK,KAAK,CAAC,CAAC,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC,QAAQ,IAAI;QACxD;QAEA,OAAO,GAAG,sBAAsB;IAClC;AACF"}},
    {"offset": {"line": 264, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/DiveIntelligence/DiveIntelligence/src/app/dive-planner-service/DiveSegmentFactory.service.ts"],"sourcesContent":["import { humanDuration } from '../utility/formatters';\nimport { DiveSegment } from './DiveSegment';\nimport { BreathingGas } from './BreathingGas';\nimport { DiveSettingsService } from './DiveSettings.service';\n\nexport class DiveSegmentFactoryService {\n  constructor(\n    private settings: DiveSettingsService\n  ) {}\n\n  createEndDiveSegment(startTime: number, depth: number, gas: BreathingGas): DiveSegment {\n    const ascentTime = this.getTravelTime(depth, 0);\n    const ascentTimeDuration = humanDuration(ascentTime);\n    const endTime = startTime + ascentTime;\n\n    return new DiveSegment(\n      startTime,\n      endTime,\n      'Surface',\n      `Ascent time: ${ascentTimeDuration} @ ${this.settings.ascentRate}m/min`,\n      depth,\n      0,\n      gas,\n      'done',\n      this.settings\n    );\n  }\n\n  createStartDiveSegment(gas: BreathingGas): DiveSegment {\n    return new DiveSegment(0, 0, 'Start Dive', gas.description, 0, 0, gas, 'scuba_diving', this.settings);\n  }\n\n  createDepthChangeSegment(startTime: number, previousDepth: number, newDepth: number, gas: BreathingGas) {\n    const travelTime = this.getTravelTime(previousDepth, newDepth);\n    const endTime = startTime + travelTime;\n    const title = newDepth > previousDepth ? `Descend to ${newDepth}m` : `Ascend to ${newDepth}m`;\n    const description =\n      newDepth > previousDepth\n        ? `Descent time: ${humanDuration(travelTime)} @ ${this.settings.descentRate}m/min`\n        : `Ascent time: ${humanDuration(travelTime)} @ ${this.settings.ascentRate}m/min`;\n    const icon = newDepth > previousDepth ? 'arrow_downward' : 'arrow_upward';\n\n    return new DiveSegment(startTime, endTime, title, description, previousDepth, newDepth, gas, icon, this.settings);\n  }\n\n  createGasChangeSegment(startTime: number, newGas: BreathingGas, depth: number) {\n    const title = 'Switch Gas';\n    const description = newGas.description;\n\n    return new DiveSegment(startTime, startTime, title, description, depth, depth, newGas, 'air', this.settings);\n  }\n\n  createMaintainDepthSegment(startTime: number, depth: number, duration: number, gas: BreathingGas) {\n    const endTime = startTime + duration;\n    const title = `Maintain Depth at ${depth}m`;\n    const description = `Time: ${humanDuration(duration)}`;\n    const icon = 'arrow_forward';\n\n    return new DiveSegment(startTime, endTime, title, description, depth, depth, gas, icon, this.settings);\n  }\n\n  getTravelTime(previousDepth: number, newDepth: number): number {\n    if (newDepth > previousDepth) {\n      return Math.round((newDepth - previousDepth) * (60 / this.settings.descentRate));\n    } else {\n      return Math.round((previousDepth - newDepth) * (60 / this.settings.ascentRate));\n    }\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAIO,MAAM;;IACX,YACE,AAAQ,QAA6B,CACrC;aADQ,WAAA;IACP;IAEH,qBAAqB,SAAiB,EAAE,KAAa,EAAE,GAAiB,EAAe;QACrF,MAAM,aAAa,IAAI,CAAC,aAAa,CAAC,OAAO;QAC7C,MAAM,qBAAqB,IAAA,gJAAa,EAAC;QACzC,MAAM,UAAU,YAAY;QAE5B,OAAO,IAAI,kKAAW,CACpB,WACA,SACA,WACA,CAAC,aAAa,EAAE,mBAAmB,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC,EACvE,OACA,GACA,KACA,QACA,IAAI,CAAC,QAAQ;IAEjB;IAEA,uBAAuB,GAAiB,EAAe;QACrD,OAAO,IAAI,kKAAW,CAAC,GAAG,GAAG,cAAc,IAAI,WAAW,EAAE,GAAG,GAAG,KAAK,gBAAgB,IAAI,CAAC,QAAQ;IACtG;IAEA,yBAAyB,SAAiB,EAAE,aAAqB,EAAE,QAAgB,EAAE,GAAiB,EAAE;QACtG,MAAM,aAAa,IAAI,CAAC,aAAa,CAAC,eAAe;QACrD,MAAM,UAAU,YAAY;QAC5B,MAAM,QAAQ,WAAW,gBAAgB,CAAC,WAAW,EAAE,SAAS,CAAC,CAAC,GAAG,CAAC,UAAU,EAAE,SAAS,CAAC,CAAC;QAC7F,MAAM,cACJ,WAAW,gBACP,CAAC,cAAc,EAAE,IAAA,gJAAa,EAAC,YAAY,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC,KAAK,CAAC,GAChF,CAAC,aAAa,EAAE,IAAA,gJAAa,EAAC,YAAY,GAAG,EAAE,IAAI,CAAC,QAAQ,CAAC,UAAU,CAAC,KAAK,CAAC;QACpF,MAAM,OAAO,WAAW,gBAAgB,mBAAmB;QAE3D,OAAO,IAAI,kKAAW,CAAC,WAAW,SAAS,OAAO,aAAa,eAAe,UAAU,KAAK,MAAM,IAAI,CAAC,QAAQ;IAClH;IAEA,uBAAuB,SAAiB,EAAE,MAAoB,EAAE,KAAa,EAAE;QAC7E,MAAM,QAAQ;QACd,MAAM,cAAc,OAAO,WAAW;QAEtC,OAAO,IAAI,kKAAW,CAAC,WAAW,WAAW,OAAO,aAAa,OAAO,OAAO,QAAQ,OAAO,IAAI,CAAC,QAAQ;IAC7G;IAEA,2BAA2B,SAAiB,EAAE,KAAa,EAAE,QAAgB,EAAE,GAAiB,EAAE;QAChG,MAAM,UAAU,YAAY;QAC5B,MAAM,QAAQ,CAAC,kBAAkB,EAAE,MAAM,CAAC,CAAC;QAC3C,MAAM,cAAc,CAAC,MAAM,EAAE,IAAA,gJAAa,EAAC,WAAW;QACtD,MAAM,OAAO;QAEb,OAAO,IAAI,kKAAW,CAAC,WAAW,SAAS,OAAO,aAAa,OAAO,OAAO,KAAK,MAAM,IAAI,CAAC,QAAQ;IACvG;IAEA,cAAc,aAAqB,EAAE,QAAgB,EAAU;QAC7D,IAAI,WAAW,eAAe;YAC5B,OAAO,KAAK,KAAK,CAAC,CAAC,WAAW,aAAa,IAAI,CAAC,KAAK,IAAI,CAAC,QAAQ,CAAC,WAAW;QAChF,OAAO;YACL,OAAO,KAAK,KAAK,CAAC,CAAC,gBAAgB,QAAQ,IAAI,CAAC,KAAK,IAAI,CAAC,QAAQ,CAAC,UAAU;QAC/E;IACF;AACF"}},
    {"offset": {"line": 321, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/DiveIntelligence/DiveIntelligence/src/app/dive-planner-service/Tissue.ts"],"sourcesContent":["import { ceilingWithThreshold } from '../utility/utility';\nimport { BreathingGas } from './BreathingGas';\nimport { DiveSegment } from './DiveSegment';\n\nexport class Tissue {\n  private tissueByTime: Map<number, { PN2: number; PHe: number }> = new Map();\n  private n2DeltaMultiplier: number = 0;\n  private heDeltaMultiplier: number = 0;\n\n  constructor(\n    public tissueNumber: number,\n    public n2HalfLife: number,\n    public a_n2: number,\n    public b_n2: number,\n    public heHalfLife: number,\n    public a_he: number,\n    public b_he: number\n  ) {\n    this.tissueByTime.set(0, {\n      PN2: this.ENVIRONMENT_PN2,\n      PHe: this.ENVIRONMENT_PHE,\n    });\n    this.n2DeltaMultiplier = 1 - Math.pow(2, -(1 / (n2HalfLife * 60)));\n    this.heDeltaMultiplier = 1 - Math.pow(2, -(1 / (heHalfLife * 60)));\n  }\n\n  readonly ENVIRONMENT_PN2 = 0.79;\n  readonly ENVIRONMENT_PHE = 0.0;\n  readonly MAX_NDL = 3600 * 5;\n\n  calculateForSegment(segment: DiveSegment) {\n    for (let t = segment.StartTimestamp; t <= segment.EndTimestamp; t++) {\n      const prevN2 = this.getTissueByTime(t - 1).PN2;\n      const gasN2 = segment.Gas.getPN2(segment.getDepth(t));\n      const n2Delta = this.getPN2Delta(prevN2, gasN2);\n\n      const prevHe = this.getTissueByTime(t - 1).PHe;\n      const gasHe = segment.Gas.getPHe(segment.getDepth(t));\n      const heDelta = this.getPHeDelta(prevHe, gasHe);\n\n      this.tissueByTime.set(t, {\n        PN2: prevN2 + n2Delta,\n        PHe: prevHe + heDelta,\n      });\n    }\n  }\n\n  discardAfterTime(time: number) {\n    this.tissueByTime = new Map(Array.from(this.tissueByTime.entries()).filter(([key]) => key <= time));\n  }\n\n  clone(): Tissue {\n    const clone = new Tissue(this.tissueNumber, this.n2HalfLife, this.a_n2, this.b_n2, this.heHalfLife, this.a_he, this.b_he);\n    clone.tissueByTime = new Map(this.tissueByTime);\n    return clone;\n  }\n\n  getInstantCeiling(time: number): number {\n    const result = (this.getMValue(time) - 1) * 10;\n    return result < 0 ? 0 : result;\n  }\n\n  getTimeToInstantCeiling(depth: number, gas: BreathingGas): number | undefined {\n    const ceiling = this.getInstantCeiling(this.tissueByTime.size - 1);\n\n    if (ceiling > 0) {\n      return 0;\n    }\n\n    const minCeiling = this.getInstantCeilingByPressures(gas.getPN2(depth), gas.getPHe(depth));\n\n    if (minCeiling === 0 || isNaN(minCeiling)) {\n      return undefined;\n    }\n\n    const pN2 = this.getPN2(this.tissueByTime.size - 1);\n    const pHe = this.getPHe(this.tissueByTime.size - 1);\n\n    let minNDL = 0;\n    let maxNDL = this.MAX_NDL;\n    let time = (maxNDL - minNDL) / 2;\n\n    while (minNDL < maxNDL) {\n      const newPN2 = pN2 + this.getPN2DeltaByTime(pN2, gas.getPN2(depth), time);\n      const newPHe = pHe + this.getPHeDeltaByTime(pHe, gas.getPHe(depth), time);\n      const newCeiling = this.getInstantCeilingByPressures(newPN2, newPHe);\n\n      if (newCeiling <= 0) {\n        minNDL = time;\n      } else {\n        maxNDL = time - 1;\n      }\n\n      time = ceilingWithThreshold((maxNDL - minNDL) / 2) + minNDL;\n    }\n\n    if (time >= this.MAX_NDL) {\n      return undefined;\n    }\n\n    return Math.floor(time);\n  }\n\n  getPN2(time: number): number {\n    return this.getTissueByTime(time).PN2;\n  }\n\n  getPHe(time: number): number {\n    return this.getTissueByTime(time).PHe;\n  }\n\n  private getInstantCeilingByPressures(pN2: number, pHe: number): number {\n    const result = (this.getMValueByPressures(pN2, pHe) - 1) * 10;\n    return result < 0 ? 0 : result;\n  }\n\n  private getTissueByTime(time: number): { PN2: number; PHe: number } {\n    return this.tissueByTime.get(time) ?? { PN2: 0, PHe: 0 };\n  }\n\n  private getPN2Delta(tissuePN2: number, gasPN2: number): number {\n    return this.getTissueDelta(tissuePN2, gasPN2, this.n2DeltaMultiplier);\n  }\n\n  private getPN2DeltaByTime(tissuePN2: number, gasPN2: number, time: number): number {\n    return this.getTissueDeltaByTime(tissuePN2, gasPN2, this.n2HalfLife, time);\n  }\n\n  private getPHeDelta(tissuePHe: number, gasPHe: number): number {\n    return this.getTissueDelta(tissuePHe, gasPHe, this.heDeltaMultiplier);\n  }\n\n  private getPHeDeltaByTime(tissuePHe: number, gasPHe: number, time: number): number {\n    return this.getTissueDeltaByTime(tissuePHe, gasPHe, this.heHalfLife, time);\n  }\n\n  private getTissueDelta(tissuePartialPressure: number, gasPartialPressure: number, deltaMultiplier: number): number {\n    return (gasPartialPressure - tissuePartialPressure) * deltaMultiplier;\n  }\n\n  private getTissueDeltaByTime(tissuePartialPressure: number, gasPartialPressure: number, halflife: number, time: number): number {\n    return (gasPartialPressure - tissuePartialPressure) * (1 - Math.pow(2, -(time / (halflife * 60))));\n  }\n\n  private getAByPressures(pN2: number, pHe: number): number {\n    return (pN2 * this.a_n2 + pHe * this.a_he) / (pN2 + pHe);\n  }\n\n  private getBByPressures(pN2: number, pHe: number): number {\n    return (pN2 * this.b_n2 + pHe * this.b_he) / (pN2 + pHe);\n  }\n\n  private getMValue(time: number): number {\n    return this.getMValueByPressures(this.getPN2(time), this.getPHe(time));\n  }\n\n  private getMValueByPressures(pN2: number, pHe: number): number {\n    return (pN2 + pHe - this.getAByPressures(pN2, pHe)) * this.getBByPressures(pN2, pHe);\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 472, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/DiveIntelligence/DiveIntelligence/src/app/dive-planner-service/BuhlmannZHL16C.ts"],"sourcesContent":["import { BreathingGas } from './BreathingGas';\nimport { DiveSegment } from './DiveSegment';\nimport { Tissue } from './Tissue';\n\nexport class BuhlmannZHL16C {\n  private tissues: Tissue[] = [];\n\n  constructor() {\n    this.tissues.push(new Tissue(1, 5, 1.1696, 0.5578, 1.51, 1.7474, 0.4245));\n    this.tissues.push(new Tissue(2, 8, 1.0, 0.6514, 3.02, 1.383, 0.5747));\n    this.tissues.push(new Tissue(3, 12.5, 0.8618, 0.7222, 4.72, 1.1919, 0.6257));\n    this.tissues.push(new Tissue(4, 18.5, 0.7562, 0.7825, 6.99, 1.0458, 0.7223));\n    this.tissues.push(new Tissue(5, 27, 0.62, 0.8126, 10.21, 0.922, 0.7582));\n    this.tissues.push(new Tissue(6, 38.3, 0.5043, 0.8434, 14.48, 0.8205, 0.7957));\n    this.tissues.push(new Tissue(7, 54.3, 0.441, 0.8693, 20.53, 0.7305, 0.8279));\n    this.tissues.push(new Tissue(8, 77, 0.4, 0.891, 29.11, 0.6502, 0.8553));\n    this.tissues.push(new Tissue(9, 109, 0.375, 0.9092, 41.2, 0.595, 0.8757));\n    this.tissues.push(new Tissue(10, 146, 0.35, 0.9222, 55.19, 0.5545, 0.8903));\n    this.tissues.push(new Tissue(11, 187, 0.3295, 0.9319, 70.69, 0.5333, 0.8997));\n    this.tissues.push(new Tissue(12, 239, 0.3065, 0.9403, 90.34, 0.5189, 0.9073));\n    this.tissues.push(new Tissue(13, 305, 0.2835, 0.9477, 115.29, 0.5181, 0.9122));\n    this.tissues.push(new Tissue(14, 390, 0.261, 0.9544, 147.42, 0.5176, 0.9171));\n    this.tissues.push(new Tissue(15, 498, 0.248, 0.9602, 188.24, 0.5172, 0.9217));\n    this.tissues.push(new Tissue(16, 635, 0.2327, 0.9653, 240.03, 0.5119, 0.9267));\n  }\n\n  clone(): BuhlmannZHL16C {\n    const result = new BuhlmannZHL16C();\n    result.tissues = this.tissues.map(t => t.clone());\n    return result;\n  }\n\n  discardAfterTime(time: number) {\n    this.tissues.forEach(t => t.discardAfterTime(time));\n  }\n\n  calculateForSegment(segment: DiveSegment) {\n    this.tissues.forEach(t => t.calculateForSegment(segment));\n  }\n\n  getInstantCeiling(time: number): number {\n    return Math.max(...this.tissues.map(t => t.getInstantCeiling(time)));\n  }\n\n  getTimeToInstantCeiling(depth: number, gas: BreathingGas): number | undefined {\n    const tissueNdls = this.tissues.map(t => t.getTimeToInstantCeiling(depth, gas));\n    const validNdls = tissueNdls.filter(x => x !== undefined) as number[];\n\n    if (validNdls.length === 0) return undefined;\n\n    return Math.min(...validNdls);\n  }\n\n  getTissueInstantCeiling(time: number, tissue: number): number {\n    return this.tissues[tissue - 1].getInstantCeiling(time);\n  }\n\n  getTissuePN2(time: number, tissue: number): number {\n    return this.tissues[tissue - 1].getPN2(time);\n  }\n\n  getTissuePHe(time: number, tissue: number): number {\n    return this.tissues[tissue - 1].getPHe(time);\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 535, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/DiveIntelligence/DiveIntelligence/src/app/dive-planner-service/DiveProfile.ts"],"sourcesContent":["import { ceilingWithThreshold } from '../utility/utility';\nimport { BreathingGas } from './BreathingGas';\nimport { BuhlmannZHL16C } from './BuhlmannZHL16C';\nimport { DiveSegment } from './DiveSegment';\nimport { DiveSegmentFactoryService } from './DiveSegmentFactory.service';\nimport { DiveSettingsService } from './DiveSettings.service';\n\nexport class DiveProfile {\n  public segments: DiveSegment[] = [];\n  public algo: BuhlmannZHL16C = new BuhlmannZHL16C();\n\n  readonly MAX_NDL = 3600 * 5;\n\n  constructor(\n    private diveSettings: DiveSettingsService,\n    private diveSegmentFactory: DiveSegmentFactoryService\n  ) {}\n\n  addDiveSegment(newDepth: number, newGas: BreathingGas, timeAtDepth: number): void {\n    this.removeLastSegment();\n\n    const previousSegment = this.getLastSegment();\n    let startTime = previousSegment.EndTimestamp;\n\n    if (newDepth !== previousSegment.EndDepth) {\n      this.addSegment(this.diveSegmentFactory.createDepthChangeSegment(startTime, previousSegment.EndDepth, newDepth, previousSegment.Gas));\n      startTime = this.getTotalTime();\n    }\n\n    if (!previousSegment.Gas.isEquivalent(newGas)) {\n      this.addSegment(this.diveSegmentFactory.createGasChangeSegment(startTime, newGas, newDepth));\n    }\n\n    if (timeAtDepth > 0) {\n      this.addSegment(this.diveSegmentFactory.createMaintainDepthSegment(startTime, newDepth, timeAtDepth, newGas));\n      startTime = this.getTotalTime();\n    }\n\n    this.addSegment(this.diveSegmentFactory.createEndDiveSegment(startTime, newDepth, newGas));\n  }\n\n  addChangeDepthSegment(newDepth: number): void {\n    this.removeLastSegment();\n    const previousSegment = this.getLastSegment();\n\n    this.addSegment(this.diveSegmentFactory.createDepthChangeSegment(previousSegment.EndTimestamp, previousSegment.EndDepth, newDepth, previousSegment.Gas));\n    this.addSegment(this.diveSegmentFactory.createEndDiveSegment(this.getTotalTime(), newDepth, previousSegment.Gas));\n  }\n\n  addChangeGasSegment(newGas: BreathingGas): void {\n    this.removeLastSegment();\n    const previousSegment = this.getLastSegment();\n\n    this.addSegment(this.diveSegmentFactory.createGasChangeSegment(previousSegment.EndTimestamp, newGas, previousSegment.EndDepth));\n    this.addSegment(this.diveSegmentFactory.createEndDiveSegment(this.getTotalTime(), previousSegment.EndDepth, newGas));\n  }\n\n  addMaintainDepthSegment(timeAtDepth: number): void {\n    this.removeLastSegment();\n    const previousSegment = this.getLastSegment();\n\n    this.addSegment(\n      this.diveSegmentFactory.createMaintainDepthSegment(previousSegment.EndTimestamp, previousSegment.EndDepth, timeAtDepth, previousSegment.Gas)\n    );\n    this.addSegment(this.diveSegmentFactory.createEndDiveSegment(this.getTotalTime(), previousSegment.EndDepth, previousSegment.Gas));\n  }\n\n  getCurrentDepth(): number {\n    return this.getPreviousSegment().EndDepth;\n  }\n\n  getTravelTime(newDepth: number): number {\n    return this.diveSegmentFactory.getTravelTime(this.getCurrentDepth(), newDepth);\n  }\n\n  startDive(startGas: BreathingGas): void {\n    this.addSegment(this.diveSegmentFactory.createStartDiveSegment(startGas));\n    this.addSegment(this.diveSegmentFactory.createEndDiveSegment(0, 0, startGas));\n  }\n\n  getCurrentGas(): BreathingGas {\n    return this.getPreviousSegment().Gas;\n  }\n\n  getCurrentDiveTime(): number {\n    return this.getPreviousSegment().EndTimestamp;\n  }\n\n  getCurrentInstantCeiling(): number {\n    const currentTime = this.getPreviousSegment().EndTimestamp;\n\n    return ceilingWithThreshold(this.algo.getInstantCeiling(currentTime));\n  }\n\n  getCurrentCeiling(): number {\n    const instantCeiling = this.getCurrentInstantCeiling();\n\n    if (this.getCurrentDepth() <= instantCeiling) {\n      return instantCeiling;\n    }\n\n    for (let t = this.getPreviousSegment().EndTimestamp; t <= this.getTotalTime(); t++) {\n      const ceiling = this.algo.getInstantCeiling(t);\n      const depth = this.getDepth(t);\n\n      if (depth < ceiling) {\n        return ceilingWithThreshold(this.getDepth(t - 1));\n      }\n    }\n\n    return 0;\n  }\n\n  getNewCeiling(newDepth: number, timeAtDepth: number): number {\n    const wipProfile = this.getWipProfile(newDepth, this.getPreviousSegment().Gas, timeAtDepth);\n\n    wipProfile.addSegment(this.diveSegmentFactory.createEndDiveSegment(wipProfile.getTotalTime(), newDepth, wipProfile.getLastSegment().Gas));\n\n    return wipProfile.getCurrentCeiling();\n  }\n\n  getNewInstantCeiling(newDepth: number, timeAtDepth: number): number {\n    const wipProfile = this.getWipProfile(newDepth, this.getPreviousSegment().Gas, timeAtDepth);\n\n    return ceilingWithThreshold(wipProfile.algo.getInstantCeiling(wipProfile.getTotalTime()));\n  }\n\n  getNoDecoLimit(newDepth: number, newGas: BreathingGas, timeAtDepth: number): number | undefined {\n    const wipProfile = this.getWipProfile(newDepth, newGas, timeAtDepth);\n\n    const ndl = wipProfile.algo.getTimeToInstantCeiling(newDepth, newGas);\n\n    if (ndl === undefined) {\n      return undefined;\n    }\n\n    wipProfile.addSegment(this.diveSegmentFactory.createMaintainDepthSegment(wipProfile.getTotalTime(), newDepth, ndl, newGas));\n\n    let minTime = 0;\n    let maxTime = 200;\n\n    if (!wipProfile.canSurfaceWithoutStops()) {\n      minTime = -ndl;\n    }\n\n    wipProfile.extendLastSegment(maxTime);\n\n    while (wipProfile.canSurfaceWithoutStops() && maxTime <= this.MAX_NDL) {\n      minTime = maxTime;\n      wipProfile.extendLastSegment(maxTime);\n      maxTime *= 2;\n    }\n\n    if (maxTime > this.MAX_NDL) {\n      return undefined;\n    }\n\n    maxTime--;\n    let time = ceilingWithThreshold((maxTime - minTime) / 2) + minTime;\n\n    wipProfile.shortenLastSegment(maxTime + 1 - time);\n\n    while (minTime < maxTime) {\n      if (wipProfile.canSurfaceWithoutStops()) {\n        minTime = time;\n        time = ceilingWithThreshold((maxTime - minTime) / 2) + minTime;\n        wipProfile.extendLastSegment(time - minTime);\n      } else {\n        maxTime = time - 1;\n        time = ceilingWithThreshold((maxTime - minTime) / 2) + minTime;\n        wipProfile.shortenLastSegment(maxTime + 1 - time);\n      }\n    }\n\n    return ndl + minTime;\n  }\n\n  // TODO: memoize this and only recalculate on the new segment bits\n  getCeilingError(): { amount: number; duration: number } {\n    let amount = 0;\n    let duration = 0;\n\n    for (let t = 0; t < this.getTotalTime(); t++) {\n      const ceiling = this.algo.getInstantCeiling(t);\n      const depth = this.getDepth(t);\n\n      if (depth < ceiling) {\n        amount = Math.max(amount, ceiling - depth);\n        duration++;\n      }\n    }\n\n    return { amount, duration };\n  }\n\n  getPO2Error(): { maxPO2: number; duration: number } {\n    let maxPO2 = 0;\n    let duration = 0;\n\n    for (let t = 0; t < this.getTotalTime(); t++) {\n      const pO2 = this.getPO2(t);\n\n      if (pO2 > this.diveSettings.decoPO2Maximum) {\n        maxPO2 = Math.max(maxPO2, pO2);\n        duration++;\n      }\n    }\n\n    return { maxPO2, duration };\n  }\n\n  getHypoxicError(): { minPO2: number; duration: number } {\n    let minPO2 = 999;\n    let duration = 0;\n\n    for (let t = 0; t < this.getTotalTime(); t++) {\n      const pO2 = this.getPO2(t);\n\n      if (pO2 < this.diveSettings.pO2Minimum) {\n        minPO2 = Math.min(minPO2, pO2);\n        duration++;\n      }\n    }\n\n    return { minPO2, duration };\n  }\n\n  getENDError(): { end: number; duration: number } {\n    let maxEND = 0;\n    let duration = 0;\n\n    for (let t = 0; t < this.getTotalTime(); t++) {\n      const end = this.getEND(t);\n\n      if (end > this.diveSettings.ENDErrorThreshold) {\n        maxEND = Math.max(end, maxEND);\n        duration++;\n      }\n    }\n\n    return { end: maxEND, duration };\n  }\n\n  getMaxDepth(): number {\n    return Math.max(...this.segments.map(x => x.EndDepth));\n  }\n\n  getAverageDepth(): number {\n    if (this.getTotalTime() === 0) return 0;\n    return this.segments.reduce((sum, current) => sum + current.getAverageDepth() * current.getDuration(), 0) / this.getTotalTime();\n  }\n\n  getTotalTime(): number {\n    if (this.segments.length === 0) return 0;\n\n    return this.getLastSegment().EndTimestamp;\n  }\n\n  addSegment(segment: DiveSegment): void {\n    this.segments.push(segment);\n    this.algo.calculateForSegment(segment);\n  }\n\n  getLastSegment(): DiveSegment {\n    return this.segments[this.segments.length - 1];\n  }\n\n  getCurrentProfile(): DiveProfile {\n    const result = this.clone();\n    result.removeLastSegment();\n\n    return result;\n  }\n\n  getPO2(time: number): number {\n    return this.getGas(time).getPO2(this.getDepth(time));\n  }\n\n  getPN2(time: number): number {\n    return this.getGas(time).getPN2(this.getDepth(time));\n  }\n\n  getPHe(time: number): number {\n    return this.getGas(time).getPHe(this.getDepth(time));\n  }\n\n  private removeLastSegment(): void {\n    this.segments.pop();\n    this.algo.discardAfterTime(this.getTotalTime());\n  }\n\n  private extendLastSegment(time: number): void {\n    this.getLastSegment().EndTimestamp += time;\n    // TODO: can improve perf by not recalculating whole segment, just the last bit of time\n    this.algo.calculateForSegment(this.getLastSegment());\n  }\n\n  private shortenLastSegment(time: number): void {\n    this.getLastSegment().EndTimestamp -= time;\n    // TODO: can improve perf by not recalculating whole segment, just throwing away some of the values instead\n    this.algo.calculateForSegment(this.getLastSegment());\n  }\n\n  private clone(): DiveProfile {\n    const result = new DiveProfile(this.diveSettings, this.diveSegmentFactory);\n    result.algo = this.algo.clone();\n    result.segments = this.segments.map(x => x.clone());\n    return result;\n  }\n\n  private getPreviousSegment(): DiveSegment {\n    return this.segments[this.segments.length - 2];\n  }\n\n  private canSurfaceWithoutStops(): boolean {\n    this.addSegment(\n      this.diveSegmentFactory.createEndDiveSegment(this.getLastSegment().EndTimestamp, this.getLastSegment().EndDepth, this.getLastSegment().Gas)\n    );\n\n    const result = this.getCeilingError().duration === 0;\n    this.removeLastSegment();\n\n    return result;\n  }\n\n  private getSegment(time: number): DiveSegment {\n    return this.segments.find(x => x.EndTimestamp > time && x.StartTimestamp <= time) ?? this.getLastSegment();\n  }\n\n  private getGas(time: number): BreathingGas {\n    return this.getSegment(time).Gas;\n  }\n\n  private getDepth(time: number): number {\n    return this.getSegment(time).getDepth(time);\n  }\n\n  private getEND(time: number): number {\n    if (this.diveSettings.isOxygenNarcotic) {\n      return (this.getPN2(time) + this.getPO2(time) - 1) * 10;\n    }\n\n    return (this.getPN2(time) / 0.79 - 1) * 10;\n  }\n\n  private getWipProfile(newDepth: number, newGas: BreathingGas, timeAtDepth: number): DiveProfile {\n    const wipProfile = this.getCurrentProfile();\n    let depth = wipProfile.getLastSegment().EndDepth;\n    let gas = wipProfile.getLastSegment().Gas;\n\n    if (newDepth !== depth) {\n      wipProfile.addSegment(this.diveSegmentFactory.createDepthChangeSegment(wipProfile.getTotalTime(), depth, newDepth, gas));\n\n      depth = newDepth;\n    }\n\n    if (newGas !== gas) {\n      wipProfile.addSegment(this.diveSegmentFactory.createGasChangeSegment(wipProfile.getTotalTime(), newGas, newDepth));\n      gas = newGas;\n    }\n\n    if (timeAtDepth > 0) {\n      wipProfile.addSegment(this.diveSegmentFactory.createMaintainDepthSegment(wipProfile.getTotalTime(), newDepth, timeAtDepth, newGas));\n    }\n\n    return wipProfile;\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 834, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/DiveIntelligence/DiveIntelligence/src/app/dive-planner-service/ChartGenerator.service.ts"],"sourcesContent":["import { DiveProfile } from './DiveProfile';\nimport { BreathingGas } from './BreathingGas';\nimport { DiveSegmentFactoryService } from './DiveSegmentFactory.service';\nimport { DiveSettingsService } from './DiveSettings.service';\n\nexport class ChartGeneratorService {\n  constructor(\n    private diveSegmentFactory: DiveSegmentFactoryService,\n    private diveSettings: DiveSettingsService\n  ) {}\n\n  getDepthChartData(diveProfile: DiveProfile): { time: number; depth: number; ceiling: number }[] {\n    const data: { time: number; depth: number; ceiling: number }[] = [];\n\n    for (const segment of diveProfile.segments) {\n      for (let time = segment.StartTimestamp; time <= segment.EndTimestamp; time++) {\n        data.push({ time: time, depth: segment.getDepth(time), ceiling: 0 });\n      }\n    }\n\n    for (const d of data) {\n      d.ceiling = diveProfile.algo.getInstantCeiling(d.time);\n    }\n\n    return data;\n  }\n\n  getPO2ChartData(diveProfile: DiveProfile): { time: number; pO2: number; decoLimit: number; limit: number; min: number }[] {\n    const data: { time: number; pO2: number; decoLimit: number; limit: number; min: number }[] = [];\n\n    for (const segment of diveProfile.segments) {\n      for (let time = segment.StartTimestamp; time <= segment.EndTimestamp; time++) {\n        data.push({\n          time: time,\n          pO2: segment.Gas.getPO2(segment.getDepth(time)),\n          decoLimit: this.diveSettings.decoPO2Maximum,\n          limit: this.diveSettings.workingPO2Maximum,\n          min: this.diveSettings.pO2Minimum,\n        });\n      }\n    }\n\n    return data;\n  }\n\n  getENDChartData(diveProfile: DiveProfile): { time: number; end: number; errorLimit: number }[] {\n    const data: { time: number; end: number; errorLimit: number }[] = [];\n\n    for (const segment of diveProfile.segments) {\n      for (let time = segment.StartTimestamp; time <= segment.EndTimestamp; time++) {\n        data.push({\n          time: time,\n          end: segment.Gas.getEND(segment.getDepth(time)),\n          errorLimit: this.diveSettings.ENDErrorThreshold,\n        });\n      }\n    }\n\n    return data;\n  }\n\n  getTissuesCeilingChartData(diveProfile: DiveProfile): { time: number; depth: number; tissuesCeiling: number[] }[] {\n    const data: {\n      time: number;\n      depth: number;\n      tissuesCeiling: number[];\n    }[] = [];\n\n    for (const segment of diveProfile.segments) {\n      for (let time = segment.StartTimestamp; time <= segment.EndTimestamp; time++) {\n        const ceilings: number[] = [];\n        for (let tissue = 1; tissue <= 16; tissue++) {\n          ceilings.push(diveProfile.algo.getTissueInstantCeiling(time, tissue));\n        }\n\n        data.push({\n          time: time,\n          depth: segment.getDepth(time),\n          tissuesCeiling: ceilings,\n        });\n      }\n    }\n\n    return data;\n  }\n\n  getTissuesPN2ChartData(diveProfile: DiveProfile): { time: number; gasPN2: number; tissuesPN2: number[] }[] {\n    const data: {\n      time: number;\n      gasPN2: number;\n      tissuesPN2: number[];\n    }[] = [];\n\n    for (let time = 0; time <= diveProfile.getTotalTime(); time++) {\n      const tissuesPN2: number[] = [];\n      for (let tissue = 1; tissue <= 16; tissue++) {\n        tissuesPN2.push(diveProfile.algo.getTissuePN2(time, tissue));\n      }\n\n      data.push({\n        time: time,\n        gasPN2: diveProfile.getPN2(time),\n        tissuesPN2,\n      });\n    }\n\n    return data;\n  }\n\n  getTissuesPHeChartData(diveProfile: DiveProfile): { time: number; gasPHe: number; tissuesPHe: number[] }[] {\n    const data: {\n      time: number;\n      gasPHe: number;\n      tissuesPHe: number[];\n    }[] = [];\n\n    for (let time = 0; time <= diveProfile.getTotalTime(); time++) {\n      const tissuesPHe: number[] = [];\n      for (let tissue = 1; tissue <= 16; tissue++) {\n        tissuesPHe.push(diveProfile.algo.getTissuePHe(time, tissue));\n      }\n\n      data.push({\n        time: time,\n        gasPHe: diveProfile.getPHe(time),\n        tissuesPHe,\n      });\n    }\n\n    return data;\n  }\n\n  getCeilingChartData(newDepth: number, newGas: BreathingGas, diveProfile: DiveProfile): { time: number; ceiling: number }[] {\n    const data: { time: number; ceiling: number }[] = [];\n\n    const wipProfile = diveProfile.getCurrentProfile();\n\n    wipProfile.addSegment(\n      this.diveSegmentFactory.createDepthChangeSegment(wipProfile.getTotalTime(), diveProfile.getCurrentDepth(), newDepth, diveProfile.getCurrentGas())\n    );\n\n    const startTime = wipProfile.getTotalTime();\n    const chartDuration = 3600 * 2; // 2 hours\n\n    wipProfile.addSegment(this.diveSegmentFactory.createMaintainDepthSegment(wipProfile.getTotalTime(), newDepth, chartDuration, newGas));\n\n    for (let time = startTime; time < startTime + chartDuration; time++) {\n      data.push({ time: time - startTime, ceiling: wipProfile.algo.getInstantCeiling(time) });\n    }\n\n    return data;\n  }\n}\n"],"names":[],"mappings":";;;;AAKO,MAAM;;;IACX,YACE,AAAQ,kBAA6C,EACrD,AAAQ,YAAiC,CACzC;aAFQ,qBAAA;aACA,eAAA;IACP;IAEH,kBAAkB,WAAwB,EAAsD;QAC9F,MAAM,OAA2D,EAAE;QAEnE,KAAK,MAAM,WAAW,YAAY,QAAQ,CAAE;YAC1C,IAAK,IAAI,OAAO,QAAQ,cAAc,EAAE,QAAQ,QAAQ,YAAY,EAAE,OAAQ;gBAC5E,KAAK,IAAI,CAAC;oBAAE,MAAM;oBAAM,OAAO,QAAQ,QAAQ,CAAC;oBAAO,SAAS;gBAAE;YACpE;QACF;QAEA,KAAK,MAAM,KAAK,KAAM;YACpB,EAAE,OAAO,GAAG,YAAY,IAAI,CAAC,iBAAiB,CAAC,EAAE,IAAI;QACvD;QAEA,OAAO;IACT;IAEA,gBAAgB,WAAwB,EAAkF;QACxH,MAAM,OAAuF,EAAE;QAE/F,KAAK,MAAM,WAAW,YAAY,QAAQ,CAAE;YAC1C,IAAK,IAAI,OAAO,QAAQ,cAAc,EAAE,QAAQ,QAAQ,YAAY,EAAE,OAAQ;gBAC5E,KAAK,IAAI,CAAC;oBACR,MAAM;oBACN,KAAK,QAAQ,GAAG,CAAC,MAAM,CAAC,QAAQ,QAAQ,CAAC;oBACzC,WAAW,IAAI,CAAC,YAAY,CAAC,cAAc;oBAC3C,OAAO,IAAI,CAAC,YAAY,CAAC,iBAAiB;oBAC1C,KAAK,IAAI,CAAC,YAAY,CAAC,UAAU;gBACnC;YACF;QACF;QAEA,OAAO;IACT;IAEA,gBAAgB,WAAwB,EAAuD;QAC7F,MAAM,OAA4D,EAAE;QAEpE,KAAK,MAAM,WAAW,YAAY,QAAQ,CAAE;YAC1C,IAAK,IAAI,OAAO,QAAQ,cAAc,EAAE,QAAQ,QAAQ,YAAY,EAAE,OAAQ;gBAC5E,KAAK,IAAI,CAAC;oBACR,MAAM;oBACN,KAAK,QAAQ,GAAG,CAAC,MAAM,CAAC,QAAQ,QAAQ,CAAC;oBACzC,YAAY,IAAI,CAAC,YAAY,CAAC,iBAAiB;gBACjD;YACF;QACF;QAEA,OAAO;IACT;IAEA,2BAA2B,WAAwB,EAA+D;QAChH,MAAM,OAIA,EAAE;QAER,KAAK,MAAM,WAAW,YAAY,QAAQ,CAAE;YAC1C,IAAK,IAAI,OAAO,QAAQ,cAAc,EAAE,QAAQ,QAAQ,YAAY,EAAE,OAAQ;gBAC5E,MAAM,WAAqB,EAAE;gBAC7B,IAAK,IAAI,SAAS,GAAG,UAAU,IAAI,SAAU;oBAC3C,SAAS,IAAI,CAAC,YAAY,IAAI,CAAC,uBAAuB,CAAC,MAAM;gBAC/D;gBAEA,KAAK,IAAI,CAAC;oBACR,MAAM;oBACN,OAAO,QAAQ,QAAQ,CAAC;oBACxB,gBAAgB;gBAClB;YACF;QACF;QAEA,OAAO;IACT;IAEA,uBAAuB,WAAwB,EAA4D;QACzG,MAAM,OAIA,EAAE;QAER,IAAK,IAAI,OAAO,GAAG,QAAQ,YAAY,YAAY,IAAI,OAAQ;YAC7D,MAAM,aAAuB,EAAE;YAC/B,IAAK,IAAI,SAAS,GAAG,UAAU,IAAI,SAAU;gBAC3C,WAAW,IAAI,CAAC,YAAY,IAAI,CAAC,YAAY,CAAC,MAAM;YACtD;YAEA,KAAK,IAAI,CAAC;gBACR,MAAM;gBACN,QAAQ,YAAY,MAAM,CAAC;gBAC3B;YACF;QACF;QAEA,OAAO;IACT;IAEA,uBAAuB,WAAwB,EAA4D;QACzG,MAAM,OAIA,EAAE;QAER,IAAK,IAAI,OAAO,GAAG,QAAQ,YAAY,YAAY,IAAI,OAAQ;YAC7D,MAAM,aAAuB,EAAE;YAC/B,IAAK,IAAI,SAAS,GAAG,UAAU,IAAI,SAAU;gBAC3C,WAAW,IAAI,CAAC,YAAY,IAAI,CAAC,YAAY,CAAC,MAAM;YACtD;YAEA,KAAK,IAAI,CAAC;gBACR,MAAM;gBACN,QAAQ,YAAY,MAAM,CAAC;gBAC3B;YACF;QACF;QAEA,OAAO;IACT;IAEA,oBAAoB,QAAgB,EAAE,MAAoB,EAAE,WAAwB,EAAuC;QACzH,MAAM,OAA4C,EAAE;QAEpD,MAAM,aAAa,YAAY,iBAAiB;QAEhD,WAAW,UAAU,CACnB,IAAI,CAAC,kBAAkB,CAAC,wBAAwB,CAAC,WAAW,YAAY,IAAI,YAAY,eAAe,IAAI,UAAU,YAAY,aAAa;QAGhJ,MAAM,YAAY,WAAW,YAAY;QACzC,MAAM,gBAAgB,OAAO,GAAG,UAAU;QAE1C,WAAW,UAAU,CAAC,IAAI,CAAC,kBAAkB,CAAC,0BAA0B,CAAC,WAAW,YAAY,IAAI,UAAU,eAAe;QAE7H,IAAK,IAAI,OAAO,WAAW,OAAO,YAAY,eAAe,OAAQ;YACnE,KAAK,IAAI,CAAC;gBAAE,MAAM,OAAO;gBAAW,SAAS,WAAW,IAAI,CAAC,iBAAiB,CAAC;YAAM;QACvF;QAEA,OAAO;IACT;AACF"}},
    {"offset": {"line": 959, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/DiveIntelligence/DiveIntelligence/src/app/dive-planner-service/DivePlannerService.ts"],"sourcesContent":["import { BreathingGas } from './BreathingGas';\nimport { DiveSegment } from './DiveSegment';\nimport { DiveSegmentFactoryService } from './DiveSegmentFactory.service';\nimport { DiveProfile } from './DiveProfile';\nimport { DiveSettingsService } from './DiveSettings.service';\nimport { ChartGeneratorService } from './ChartGenerator.service';\n\nexport class DivePlannerService {\n  private diveID = crypto.randomUUID();\n  private diveProfile: DiveProfile;\n  private chartGenerator: ChartGeneratorService;\n  private diveSegmentFactory: DiveSegmentFactoryService;\n\n  constructor(\n    public settings: DiveSettingsService\n  ) {\n    this.diveSegmentFactory = new DiveSegmentFactoryService(settings);\n    this.chartGenerator = new ChartGeneratorService(this.diveSegmentFactory, settings);\n    this.diveProfile = new DiveProfile(settings, this.diveSegmentFactory);\n    BreathingGas.GenerateStandardGases(settings);\n  }\n\n  getStandardGases(): BreathingGas[] {\n    return BreathingGas.StandardGases;\n  }\n\n  startDive(startGas: BreathingGas) {\n    this.diveProfile = new DiveProfile(this.settings, this.diveSegmentFactory);\n    this.diveProfile.startDive(startGas);\n    this.diveID = crypto.randomUUID();\n  }\n\n  getDiveSegments(): DiveSegment[] {\n    return this.diveProfile.segments;\n  }\n\n  getDiveDuration(): number {\n    return this.diveProfile.getTotalTime();\n  }\n\n  getMaxDepth(): number {\n    return this.diveProfile.getMaxDepth();\n  }\n\n  getAverageDepth(): number {\n    return this.diveProfile.getAverageDepth();\n  }\n\n  getCurrentDepth(): number {\n    return this.diveProfile.getCurrentDepth();\n  }\n\n  getOptimalDecoGas(depth: number): BreathingGas {\n    return BreathingGas.getOptimalDecoGas(depth, this.settings);\n  }\n\n  getCurrentCeiling(): number {\n    return this.diveProfile.getCurrentCeiling();\n  }\n\n  getCurrentInstantCeiling(): number {\n    return this.diveProfile.getCurrentInstantCeiling();\n  }\n\n  getCurrentGas(): BreathingGas {\n    return this.diveProfile.getCurrentGas();\n  }\n\n  getCurrentDiveTime(): number {\n    return this.diveProfile.getCurrentDiveTime();\n  }\n\n  getNoDecoLimit(newDepth: number, newGas: BreathingGas, timeAtDepth: number): number | undefined {\n    return this.diveProfile.getNoDecoLimit(newDepth, newGas, timeAtDepth);\n  }\n\n  addChangeDepthSegment(newDepth: number): void {\n    this.diveProfile.addChangeDepthSegment(newDepth);\n  }\n\n  addChangeGasSegment(newGas: BreathingGas): void {\n    this.diveProfile.addChangeGasSegment(newGas);\n  }\n\n  addMaintainDepthSegment(timeAtDepth: number): void {\n    this.diveProfile.addMaintainDepthSegment(timeAtDepth);\n  }\n\n  getTravelTime(newDepth: number): number {\n    return this.diveProfile.getTravelTime(newDepth);\n  }\n\n  getDepthChartData(): { time: number; depth: number; ceiling: number }[] {\n    return this.chartGenerator.getDepthChartData(this.diveProfile);\n  }\n\n  getPO2ChartData(): { time: number; pO2: number; decoLimit: number; limit: number; min: number }[] {\n    return this.chartGenerator.getPO2ChartData(this.diveProfile);\n  }\n\n  getENDChartData(): { time: number; end: number; errorLimit: number }[] {\n    return this.chartGenerator.getENDChartData(this.diveProfile);\n  }\n\n  getTissuesCeilingChartData(): { time: number; depth: number; tissuesCeiling: number[] }[] {\n    return this.chartGenerator.getTissuesCeilingChartData(this.diveProfile);\n  }\n\n  getTissuesPN2ChartData(): { time: number; gasPN2: number; tissuesPN2: number[] }[] {\n    return this.chartGenerator.getTissuesPN2ChartData(this.diveProfile);\n  }\n\n  getTissuesPHeChartData(): { time: number; gasPHe: number; tissuesPHe: number[] }[] {\n    return this.chartGenerator.getTissuesPHeChartData(this.diveProfile);\n  }\n\n  getCeilingChartData(newDepth: number, newGas: BreathingGas): { time: number; ceiling: number }[] {\n    return this.chartGenerator.getCeilingChartData(newDepth, newGas, this.diveProfile);\n  }\n\n  getNewCeiling(newDepth: number, timeAtDepth: number): number {\n    return this.diveProfile.getNewCeiling(newDepth, timeAtDepth);\n  }\n\n  getNewInstantCeiling(newDepth: number, timeAtDepth: number): number {\n    return this.diveProfile.getNewInstantCeiling(newDepth, timeAtDepth);\n  }\n\n  getCeilingError(): { amount: number; duration: number } {\n    return this.diveProfile.getCeilingError();\n  }\n\n  getPO2Error(): { maxPO2: number; duration: number } {\n    return this.diveProfile.getPO2Error();\n  }\n\n  getHypoxicError(): { minPO2: number; duration: number } {\n    return this.diveProfile.getHypoxicError();\n  }\n\n  getENDError(): { end: number; duration: number } {\n    return this.diveProfile.getENDError();\n  }\n\n  getPO2WarningMessage(pO2: number): string | undefined {\n    if (pO2 > this.settings.workingPO2Maximum && pO2 <= this.settings.decoPO2Maximum)\n      return `Oxygen partial pressure should only go above ${this.settings.workingPO2Maximum} during deco stops`;\n    return undefined;\n  }\n\n  getPO2ErrorMessage(pO2: number): string | undefined {\n    if (pO2 > this.settings.decoPO2Maximum) return `Oxygen partial pressure should never go above ${this.settings.decoPO2Maximum}`;\n    if (pO2 < this.settings.pO2Minimum) return `Oxygen partial pressure should never go below ${this.settings.pO2Minimum}`;\n    return undefined;\n  }\n\n  getENDErrorMessage(END: number): string | undefined {\n    if (END > this.settings.ENDErrorThreshold) return this.settings.ENDErrorMessage;\n    return undefined;\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1098, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/DiveIntelligence/DiveIntelligence/src/app/dive-planner-service/DiveSettings.service.ts"],"sourcesContent":["export class DiveSettingsService {\n  private _ascentRate = 10;\n  private _descentRate = 20;\n  private _isOxygenNarcotic = true;\n  private _workingPO2Maximum = 1.4;\n  private _decoPO2Maximum = 1.6;\n  private _pO2Minimum = 0.18;\n  private _ENDErrorThreshold = 30;\n  private _subscribers: (() => void)[] = [];\n\n  subscribeToChanges(callback: () => void): void {\n    this._subscribers.push(callback);\n  }\n\n  private onSettingChange(): void {\n    this._subscribers.forEach(x => x());\n  }\n\n  set ascentRate(rate: number) {\n    this._ascentRate = rate;\n    this.onSettingChange();\n  }\n\n  get ascentRate(): number {\n    return this._ascentRate;\n  }\n\n  set descentRate(rate: number) {\n    this._descentRate = rate;\n    this.onSettingChange();\n  }\n\n  get descentRate(): number {\n    return this._descentRate;\n  }\n\n  set isOxygenNarcotic(isNarcotic: boolean) {\n    this._isOxygenNarcotic = isNarcotic;\n    this.onSettingChange();\n  }\n\n  get isOxygenNarcotic(): boolean {\n    return this._isOxygenNarcotic;\n  }\n\n  set workingPO2Maximum(threshold: number) {\n    this._workingPO2Maximum = threshold;\n    this.onSettingChange();\n  }\n\n  get workingPO2Maximum(): number {\n    return this._workingPO2Maximum;\n  }\n\n  set decoPO2Maximum(threshold: number) {\n    this._decoPO2Maximum = threshold;\n    this.onSettingChange();\n  }\n\n  get decoPO2Maximum(): number {\n    return this._decoPO2Maximum;\n  }\n\n  get pO2Minimum(): number {\n    return this._pO2Minimum;\n  }\n\n  set pO2Minimum(value: number) {\n    this._pO2Minimum = value;\n    this.onSettingChange();\n  }\n\n  set ENDErrorThreshold(threshold: number) {\n    this._ENDErrorThreshold = threshold;\n    this.onSettingChange();\n  }\n\n  get ENDErrorThreshold(): number {\n    return this._ENDErrorThreshold;\n  }\n\n  get ENDErrorMessage(): string {\n    return `END is above the configured error threshold of ${this._ENDErrorThreshold}m`;\n  }\n\n  get MaxDepthPO2Tooltip(): string {\n    return `Maximum depth this gas can be breathed at without going over an oxygen partial pressure of ${this.workingPO2Maximum} (${this.decoPO2Maximum} for deco stops)`;\n  }\n\n  get MaxDepthENDTooltip(): string {\n    return `Maximum depth this gas can be breathed at before you experience narcosis equivalent to ${this._ENDErrorThreshold}m on air`;\n  }\n\n  get MinDepthTooltip(): string {\n    return `Minimum depth this gas can be breathed at before you experience hypoxia (PO2 < ${this.pO2Minimum})`;\n  }\n}\n"],"names":[],"mappings":";;;;AAAO,MAAM;IACH,cAAc,GAAG;IACjB,eAAe,GAAG;IAClB,oBAAoB,KAAK;IACzB,qBAAqB,IAAI;IACzB,kBAAkB,IAAI;IACtB,cAAc,KAAK;IACnB,qBAAqB,GAAG;IACxB,eAA+B,EAAE,CAAC;IAE1C,mBAAmB,QAAoB,EAAQ;QAC7C,IAAI,CAAC,YAAY,CAAC,IAAI,CAAC;IACzB;IAEQ,kBAAwB;QAC9B,IAAI,CAAC,YAAY,CAAC,OAAO,CAAC,CAAA,IAAK;IACjC;IAEA,IAAI,WAAW,IAAY,EAAE;QAC3B,IAAI,CAAC,WAAW,GAAG;QACnB,IAAI,CAAC,eAAe;IACtB;IAEA,IAAI,aAAqB;QACvB,OAAO,IAAI,CAAC,WAAW;IACzB;IAEA,IAAI,YAAY,IAAY,EAAE;QAC5B,IAAI,CAAC,YAAY,GAAG;QACpB,IAAI,CAAC,eAAe;IACtB;IAEA,IAAI,cAAsB;QACxB,OAAO,IAAI,CAAC,YAAY;IAC1B;IAEA,IAAI,iBAAiB,UAAmB,EAAE;QACxC,IAAI,CAAC,iBAAiB,GAAG;QACzB,IAAI,CAAC,eAAe;IACtB;IAEA,IAAI,mBAA4B;QAC9B,OAAO,IAAI,CAAC,iBAAiB;IAC/B;IAEA,IAAI,kBAAkB,SAAiB,EAAE;QACvC,IAAI,CAAC,kBAAkB,GAAG;QAC1B,IAAI,CAAC,eAAe;IACtB;IAEA,IAAI,oBAA4B;QAC9B,OAAO,IAAI,CAAC,kBAAkB;IAChC;IAEA,IAAI,eAAe,SAAiB,EAAE;QACpC,IAAI,CAAC,eAAe,GAAG;QACvB,IAAI,CAAC,eAAe;IACtB;IAEA,IAAI,iBAAyB;QAC3B,OAAO,IAAI,CAAC,eAAe;IAC7B;IAEA,IAAI,aAAqB;QACvB,OAAO,IAAI,CAAC,WAAW;IACzB;IAEA,IAAI,WAAW,KAAa,EAAE;QAC5B,IAAI,CAAC,WAAW,GAAG;QACnB,IAAI,CAAC,eAAe;IACtB;IAEA,IAAI,kBAAkB,SAAiB,EAAE;QACvC,IAAI,CAAC,kBAAkB,GAAG;QAC1B,IAAI,CAAC,eAAe;IACtB;IAEA,IAAI,oBAA4B;QAC9B,OAAO,IAAI,CAAC,kBAAkB;IAChC;IAEA,IAAI,kBAA0B;QAC5B,OAAO,CAAC,+CAA+C,EAAE,IAAI,CAAC,kBAAkB,CAAC,CAAC,CAAC;IACrF;IAEA,IAAI,qBAA6B;QAC/B,OAAO,CAAC,2FAA2F,EAAE,IAAI,CAAC,iBAAiB,CAAC,EAAE,EAAE,IAAI,CAAC,cAAc,CAAC,gBAAgB,CAAC;IACvK;IAEA,IAAI,qBAA6B;QAC/B,OAAO,CAAC,uFAAuF,EAAE,IAAI,CAAC,kBAAkB,CAAC,QAAQ,CAAC;IACpI;IAEA,IAAI,kBAA0B;QAC5B,OAAO,CAAC,+EAA+E,EAAE,IAAI,CAAC,UAAU,CAAC,CAAC,CAAC;IAC7G;AACF"}},
    {"offset": {"line": 1186, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/DiveIntelligence/DiveIntelligence/src/app/contexts/DivePlannerContext.tsx"],"sourcesContent":["'use client';\n\nimport React, { createContext, useContext, useState, useMemo, useCallback, ReactNode } from 'react';\nimport { DivePlannerService } from '../dive-planner-service/DivePlannerService';\nimport { DiveSettingsService } from '../dive-planner-service/DiveSettings.service';\nimport { BreathingGas } from '../dive-planner-service/BreathingGas';\n\ninterface DivePlannerContextType {\n  divePlanner: DivePlannerService;\n  updateTrigger: number;\n  forceUpdate: () => void;\n}\n\nconst DivePlannerContext = createContext<DivePlannerContextType | undefined>(undefined);\n\nexport function DivePlannerProvider({ children }: { children: ReactNode }) {\n  const [updateTrigger, setUpdateTrigger] = useState(0);\n  \n  const divePlanner = useMemo(() => {\n    const settings = new DiveSettingsService();\n    return new DivePlannerService(settings);\n  }, []);\n\n  const forceUpdate = useCallback(() => {\n    setUpdateTrigger(prev => prev + 1);\n  }, []);\n\n  const value = useMemo(() => ({\n    divePlanner,\n    updateTrigger,\n    forceUpdate,\n  }), [divePlanner, updateTrigger, forceUpdate]);\n\n  return (\n    <DivePlannerContext.Provider value={value}>\n      {children}\n    </DivePlannerContext.Provider>\n  );\n}\n\nexport function useDivePlanner() {\n  const context = useContext(DivePlannerContext);\n  if (context === undefined) {\n    throw new Error('useDivePlanner must be used within a DivePlannerProvider');\n  }\n  return context;\n}\n\n// Hook for starting a dive\nexport function useStartDive() {\n  const { divePlanner, forceUpdate } = useDivePlanner();\n  \n  return useCallback((startGas: BreathingGas) => {\n    divePlanner.startDive(startGas);\n    forceUpdate();\n  }, [divePlanner, forceUpdate]);\n}\n\n// Hook for adding a change depth segment\nexport function useAddChangeDepthSegment() {\n  const { divePlanner, forceUpdate } = useDivePlanner();\n  \n  return useCallback((newDepth: number) => {\n    divePlanner.addChangeDepthSegment(newDepth);\n    forceUpdate();\n  }, [divePlanner, forceUpdate]);\n}\n\n// Hook for adding a change gas segment\nexport function useAddChangeGasSegment() {\n  const { divePlanner, forceUpdate } = useDivePlanner();\n  \n  return useCallback((newGas: BreathingGas) => {\n    divePlanner.addChangeGasSegment(newGas);\n    forceUpdate();\n  }, [divePlanner, forceUpdate]);\n}\n\n// Hook for adding a maintain depth segment\nexport function useAddMaintainDepthSegment() {\n  const { divePlanner, forceUpdate } = useDivePlanner();\n  \n  return useCallback((timeAtDepth: number) => {\n    divePlanner.addMaintainDepthSegment(timeAtDepth);\n    forceUpdate();\n  }, [divePlanner, forceUpdate]);\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;AAEA;AACA;AACA;;;AAJA;;;;AAaA,MAAM,mCAAqB,IAAA,8KAAa,EAAqC;AAEtE,SAAS,oBAAoB,EAAE,QAAQ,EAA2B;;IACvE,MAAM,CAAC,eAAe,iBAAiB,GAAG,IAAA,yKAAQ,EAAC;IAEnD,MAAM,cAAc,IAAA,wKAAO;oDAAC;YAC1B,MAAM,WAAW,IAAI,sLAAmB;YACxC,OAAO,IAAI,gLAAkB,CAAC;QAChC;mDAAG,EAAE;IAEL,MAAM,cAAc,IAAA,4KAAW;wDAAC;YAC9B;gEAAiB,CAAA,OAAQ,OAAO;;QAClC;uDAAG,EAAE;IAEL,MAAM,QAAQ,IAAA,wKAAO;8CAAC,IAAM,CAAC;gBAC3B;gBACA;gBACA;YACF,CAAC;6CAAG;QAAC;QAAa;QAAe;KAAY;IAE7C,qBACE,6LAAC,mBAAmB,QAAQ;QAAC,OAAO;kBACjC;;;;;;AAGP;GAvBgB;KAAA;AAyBT,SAAS;;IACd,MAAM,UAAU,IAAA,2KAAU,EAAC;IAC3B,IAAI,YAAY,WAAW;QACzB,MAAM,IAAI,MAAM;IAClB;IACA,OAAO;AACT;IANgB;AAST,SAAS;;IACd,MAAM,EAAE,WAAW,EAAE,WAAW,EAAE,GAAG;IAErC,OAAO,IAAA,4KAAW;oCAAC,CAAC;YAClB,YAAY,SAAS,CAAC;YACtB;QACF;mCAAG;QAAC;QAAa;KAAY;AAC/B;IAPgB;;QACuB;;;AAShC,SAAS;;IACd,MAAM,EAAE,WAAW,EAAE,WAAW,EAAE,GAAG;IAErC,OAAO,IAAA,4KAAW;gDAAC,CAAC;YAClB,YAAY,qBAAqB,CAAC;YAClC;QACF;+CAAG;QAAC;QAAa;KAAY;AAC/B;IAPgB;;QACuB;;;AAShC,SAAS;;IACd,MAAM,EAAE,WAAW,EAAE,WAAW,EAAE,GAAG;IAErC,OAAO,IAAA,4KAAW;8CAAC,CAAC;YAClB,YAAY,mBAAmB,CAAC;YAChC;QACF;6CAAG;QAAC;QAAa;KAAY;AAC/B;IAPgB;;QACuB;;;AAShC,SAAS;;IACd,MAAM,EAAE,WAAW,EAAE,WAAW,EAAE,GAAG;IAErC,OAAO,IAAA,4KAAW;kDAAC,CAAC;YAClB,YAAY,uBAAuB,CAAC;YACpC;QACF;iDAAG;QAAC;QAAa;KAAY;AAC/B;IAPgB;;QACuB"}},
    {"offset": {"line": 1339, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/DiveIntelligence/DiveIntelligence/src/app/theme.ts"],"sourcesContent":["'use client';\n\nimport { createTheme } from '@mui/material/styles';\nimport { indigo, purple, red } from '@mui/material/colors';\n\nconst theme = createTheme({\n  palette: {\n    primary: {\n      main: indigo[500],\n    },\n    secondary: {\n      main: purple['A200'],\n    },\n    error: {\n      main: red[500],\n    },\n    warning: {\n      main: '#FFC107',\n    },\n  },\n  typography: {\n    fontFamily: 'Roboto, \"Helvetica Neue\", sans-serif',\n  },\n});\n\nexport default theme;\n"],"names":[],"mappings":";;;;AAEA;AACA;AAAA;AAAA;AAHA;;;AAKA,MAAM,QAAQ,IAAA,6NAAW,EAAC;IACxB,SAAS;QACP,SAAS;YACP,MAAM,8MAAM,CAAC,IAAI;QACnB;QACA,WAAW;YACT,MAAM,8MAAM,CAAC,OAAO;QACtB;QACA,OAAO;YACL,MAAM,qMAAG,CAAC,IAAI;QAChB;QACA,SAAS;YACP,MAAM;QACR;IACF;IACA,YAAY;QACV,YAAY;IACd;AACF;uCAEe"}},
    {"offset": {"line": 1377, "column": 0}, "map": {"version":3,"sources":["file:///home/runner/work/DiveIntelligence/DiveIntelligence/src/app/providers.tsx"],"sourcesContent":["'use client';\n\nimport { ThemeProvider } from '@mui/material/styles';\nimport CssBaseline from '@mui/material/CssBaseline';\nimport { DivePlannerProvider } from './contexts/DivePlannerContext';\nimport theme from './theme';\n\nexport default function Providers({ children }: { children: React.ReactNode }) {\n  return (\n    <ThemeProvider theme={theme}>\n      <CssBaseline />\n      <DivePlannerProvider>\n        {children}\n      </DivePlannerProvider>\n    </ThemeProvider>\n  );\n}\n"],"names":[],"mappings":";;;;;AAEA;AACA;AACA;AACA;AALA;;;;;;AAOe,SAAS,UAAU,EAAE,QAAQ,EAAiC;IAC3E,qBACE,6LAAC,mOAAa;QAAC,OAAO,0HAAK;;0BACzB,6LAAC,oLAAW;;;;;0BACZ,6LAAC,gKAAmB;0BACjB;;;;;;;;;;;;AAIT;KATwB"}}]
}